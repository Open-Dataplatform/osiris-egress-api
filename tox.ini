[tox]
skipsdist = True

[testenv]
basepython = python3
usedevelop = True
deps =
    pytest
    pytest-tornasync
    pytest-cov
    pytest-mock
    mock
    coverage
    -rrequirements.txt
setenv =
    PYTHONDONTWRITEBYTECODE = 1
    LINT_TARGETS = {toxinidir}/app/

commands = pytest --cov-config tox.ini \
                   --cov-report '' \
                   --cov {posargs}

[testenv:py3]
description = {envpython}
deps = {[testenv]deps}

[testenv:flake8]
description = Run flake8.
skip_install = true
deps = flake8

commands = flake8 {env:LINT_TARGETS}

[flake8]
ignore = D104, W503 # Rule W503 is in conflict with W504 which is the new best practice
max-line-length = 120
max-complexity = 10

[testenv:pylint]
description = Run pylint.
deps = pylint
       -rrequirements.txt
disable = F0010
extension-pkg-whitelist = pydantic

commands = pylint --rcfile=tox.ini {env:LINT_TARGETS}

[testenv:bandit]
description = Run bandit.
deps = bandit
commands = bandit -r {env:LINT_TARGETS}

[testenv:mypy]
description = Run mypy.
deps = mypy

commands = mypy {env:LINT_TARGETS}